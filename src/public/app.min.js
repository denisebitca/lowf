const CONNECTED=0,LOOKING=1,PAIRED=2,DISCONNECTED=3,BANNED=4;var myName,set,partnerName,currentState=0,sent=!1,disconnectInitiated=!1;"serviceWorker"in navigator&&window.addEventListener("load",function(){navigator.serviceWorker.register("./sw.js").then(a=>{console.log("Service worker registered!",a)}).catch(a=>{console.log("Service worker registration failed: ",a)})}),document.addEventListener("visibilitychange",isVisible,!1);function isVisible(){return!document.hidden}var audio,disconnect,system,aObj,dObj,sObj,report=!1;function getCookie(a){var b=" "+document.cookie,c=b.indexOf(" "+a+"=");if(-1==c)b=null;else{c=b.indexOf("=",c)+1;var d=b.indexOf(";",c);-1==d&&(d=b.length),b=unescape(b.substring(c,d))}return b}function setCookie(a,b,c){var d="";if(c){var e=new Date;e.setTime(e.getTime()+1e3*(60*(60*(24*c)))),d="; expires="+e.toUTCString()}document.cookie=a+"="+(b||"")+d+"; path=/"}darkmode(!0);function displayImportantMessage(a){document.querySelectorAll(".lds-css")[0].remove(),$("#overlay>span").text(a),$("#overlay").show()}window.onload=()=>{window.Worker&&window.WebSocket&&window.Notification?(document.querySelector("#button_connect").addEventListener("click",()=>{1<=$("#namebox").val().length&&50>=$("#namebox").val().length?(window.ws.postMessage({body:4,message:document.querySelector("#namebox").value}),myName=document.querySelector("#namebox").value,$("#namebox-settings").val(myName),window.ws.postMessage(0),getCookie("sound")?"on"===getCookie("sound")?(aObj=new Audio("./sounds/notification.mp3"),dObj=new Audio("./sounds/disconnect.mp3"),sObj=new Audio("./sounds/system.mp3"),audio={play:function(){isVisible()||aObj.play()}},disconnect={play:function(){isVisible()||dObj.play()}},system={play:function(){isVisible()||sObj.play()}},$("#sound").prop("checked","true")):(audio={play:function(){}},disconnect={play:function(){}},system={play:function(){}}):(aObj=new Audio("./sounds/notification.mp3"),dObj=new Audio("./sounds/disconnect.mp3"),sObj=new Audio("./sounds/system.mp3"),audio={play:function(){isVisible()||aObj.play()}},disconnect={play:function(){isVisible()||dObj.play()}},system={play:function(){isVisible()||sObj.play()}},setCookie("sound","on",60),$("#sound").prop("checked","true"))):$.notify("Invalid name!")}),window.ws=new Worker("worker.js"),window.ws.onmessage=function(a){var c="";try{c=JSON.parse(a.data)}catch(b){"disconnect"===a.data?displayImportantMessage("A connection could not be made to the Lowf chatting server. Please refresh, check your Internet connection and check that you don't have a tab with Lowf already open."):"maintenance"===a.data?displayImportantMessage("Lowf is currently under maintenance. We apologise for the inconvenience."):"open"===a.data&&$("#overlay").hide()}if("object"==typeof c)if("state"===c.type)switch(c.body){case LOOKING:report=!1,$("#return>.back").text("exit_to_app"),currentState===CONNECTED&&($("#mainpage").hide(),$("#chat").show()),chat_clear(),chat_entry("system","Looking for someone to chat with..."),$("#textbox").attr("disabled",""),$("#namebox-settings").attr("disabled"),currentState=LOOKING;break;case PAIRED:$("#return>.back").text("exit_to_app"),chat_clear(),audio.play(),chat_entry("system","This is a conversation between you, "+myName+", and "+c.message+"."),partnerName=c.message,$("#textbox").removeAttr("disabled"),$("#namebox-settings").removeAttr("disabled"),currentState=PAIRED;break;case DISCONNECTED:if($("#return>.back").text("done"),disconnectInitiated){var d="You have ";disconnectInitiated=!1}else{disconnect.play();var d=partnerName+" has "}if($("#textbox").attr("disabled",""),chat_entry("system"," "),chat_entry("system",d+"disconnected.",""),chat_entry("system"," "),c.message){chat_entry("system","Your conversation has been saved at https://lowf.codes/logs/"+c.message+".txt. Conversations are kept for one day.");var e=$("<div></div>"),f=$("<div></div>"),b=$("<span></span>");b.text("Report user"),f.append(b),f.attr("class","button"),f.attr("id","button_report"),"true"===getCookie("darkmode")&&(f.attr("data-theme","darkmode"),b.attr("data-theme","darkmode")),f.on("click",()=>{currentState===DISCONNECTED&&!1===report&&(window.ws.postMessage(3),report=!0,$("#button_report").remove(),$.notify("User reported!"))}),e.append(f),$("#messagecontainer").append(e)}currentState=DISCONNECTED;break;case BANNED:displayImportantMessage("You have been banned. To appeal your ban, send an email to lowfchat@gmail.com with your IP address and why you should be unbanned.");}else"message"===c.type&&(0===c.body?(system.play(),chat_entry("system",c.message,"System message: ")):c.body===myName&&sent?(chat_entry("receiver",c.message,c.body),sent=!1):(audio.play(),chat_entry("sender",c.message,c.body)))}):displayImportantMessage("Your browser does not support Lowf. We're sorry for the inconvenience.")};function chat_entry(a,b,c){var d,e,f=document.createElement("div"),d=document.createElement("span"),e=document.createElement("span");f.setAttribute("class","message "+a),"system"===a?d.textContent=b:(d.textContent=c+": ",e.textContent=b),f.append(d),"system"===a?null:f.append(e),document.querySelector("#messagecontainer").append(f)}function chat_clear(){for(;$("#messagecontainer>div:nth-child(1)")[0];)$("#messagecontainer").find("div:first").remove()}function submitOnEnter(a){13===a.which&&(currentState===PAIRED?""==$("#textbox").val()?a.preventDefault():(send(2,$("#textbox").val()),$("#textbox").val(""),a.preventDefault()):a.preventDefault())}function dcOrRc(){currentState===DISCONNECTED||currentState===CONNECTED?window.ws.postMessage(0):(window.ws.postMessage(1),disconnectInitiated=!0)}function send(a,b){if(currentState===PAIRED){window.ws.postMessage({body:a,message:b}),sent=!0}}document.getElementById("textbox").addEventListener("keypress",submitOnEnter),document.getElementById("button").addEventListener("click",()=>{""!=$("#textbox").val()&&(send(2,$("#textbox").val()),$("#textbox").val(""))}),document.getElementById("button_changename").addEventListener("click",()=>{currentState!=LOOKING&&currentState!=CONNECTED&&(50>=$("#namebox-settings").val().length&&1<=$("#namebox-settings").val().length?(window.ws.postMessage({body:4,message:$("#namebox-settings").val()}),myName=$("#namebox-settings").val()):$.notify("Invalid name!"))}),document.getElementById("return").addEventListener("click",dcOrRc),$("#sound").on("click",function(){$("#sound").prop("checked")?(setCookie("sound","on",60),currentState!=CONNECTED&&(aObj=new Audio("./sounds/notification.mp3"),dObj=new Audio("./sounds/disconnect.mp3"),sObj=new Audio("./sounds/system.mp3"),audio={play:function(){isVisible()||aObj.play()}},disconnect={play:function(){isVisible()||dObj.play()}},system={play:function(){isVisible()||sObj.play()}})):(setCookie("sound","off",60),currentState!=CONNECTED&&(audio={play:function(){}},disconnect={play:function(){}},system={play:function(){}}))}),$(".settings").on("click",function(){if(set){set=!1;const a=document.querySelector("#settingsmenu");a.classList.remove("slideInRight"),a.classList.add("animated","slideOutRight")}else{set=!0,$("#settingsmenu").attr("style","display: flex");const a=document.querySelector("#settingsmenu");a.classList.remove("slideOutRight"),a.classList.add("animated","slideInRight")}}),$("#darkmode").on("click",function(){darkmode()}),"off"===getCookie("sound")&&$("#sound").prop("checked","");function darkmode(a){getCookie("darkmode")&&!a?"false"===getCookie("darkmode")?(setCookie("darkmode","true",60),$("span").attr("data-theme","darkmode"),document.querySelector("#overlay").setAttribute("data-theme","darkmode"),$("body").attr("data-theme","darkmode"),$("html").attr("data-theme","darkmode"),$("h2").attr("data-theme","darkmode"),$("i").attr("data-theme","darkmode"),$("#navbar").attr("data-theme","darkmode"),$(".settings").attr("data-theme","darkmode"),$(".back").attr("data-theme","darkmode"),$("#settingsmenu").attr("data-theme","darkmode"),$(".button").attr("data-theme","darkmode"),$("#button").attr("data-theme","darkmode"),$(".send").attr("data-theme","darkmode"),$("#button_report").attr("data-theme","darkmode"),$("#sendbox").attr("data-theme","darkmode"),$("#messagecontainer").attr("data-theme","darkmode"),$("#textbox").attr("data-theme","darkmode")):"true"===getCookie("darkmode")&&(setCookie("darkmode","false",60),$("span").attr("data-theme",""),document.querySelector("#overlay").setAttribute("data-theme",""),$("#button_report").attr("data-theme",""),$("body").attr("data-theme",""),$("html").attr("data-theme",""),$("h2").attr("data-theme",""),$("i").attr("data-theme",""),$("#navbar").attr("data-theme",""),$(".settings").attr("data-theme",""),$(".back").attr("data-theme",""),$("#settingsmenu").attr("data-theme",""),$(".button").attr("data-theme",""),$("#button").attr("data-theme",""),$(".send").attr("data-theme",""),$("#sendbox").attr("data-theme",""),$("#messagecontainer").attr("data-theme",""),$("#textbox").attr("data-theme","")):a?"true"===getCookie("darkmode")?($("#darkmode").prop("checked","true"),$("span").attr("data-theme","darkmode"),document.querySelector("#overlay").setAttribute("data-theme","darkmode"),$("body").attr("data-theme","darkmode"),$("html").attr("data-theme","darkmode"),$("h2").attr("data-theme","darkmode"),$("i").attr("data-theme","darkmode"),$("#navbar").attr("data-theme","darkmode"),$(".settings").attr("data-theme","darkmode"),$(".back").attr("data-theme","darkmode"),$("#settingsmenu").attr("data-theme","darkmode"),$(".button").attr("data-theme","darkmode"),$("#button").attr("data-theme","darkmode"),$(".send").attr("data-theme","darkmode"),$("#sendbox").attr("data-theme","darkmode"),$("#messagecontainer").attr("data-theme","darkmode"),$("#textbox").attr("data-theme","darkmode")):"false"===getCookie("darkmode")&&($("#darkmode").prop("checked",""),$("span").attr("data-theme",""),document.querySelector("#overlay").setAttribute("data-theme",""),$("body").attr("data-theme",""),$("html").attr("data-theme",""),$("h2").attr("data-theme",""),$("i").attr("data-theme",""),$("#navbar").attr("data-theme",""),$(".settings").attr("data-theme",""),$(".back").attr("data-theme",""),$("#settingsmenu").attr("data-theme",""),$(".button").attr("data-theme",""),$("#button").attr("data-theme",""),$(".send").attr("data-theme",""),$("#sendbox").attr("data-theme",""),$("#messagecontainer").attr("data-theme",""),$("#textbox").attr("data-theme","")):!a&&(setCookie("darkmode","true",60),$("span").attr("data-theme","darkmode"),document.querySelector("#overlay").setAttribute("data-theme","darkmode"),$("body").attr("data-theme","darkmode"),$("html").attr("data-theme","darkmode"),$("h2").attr("data-theme","darkmode"),$("i").attr("data-theme","darkmode"),$("#navbar").attr("data-theme","darkmode"),$(".settings").attr("data-theme","darkmode"),$(".back").attr("data-theme","darkmode"),$("#settingsmenu").attr("data-theme","darkmode"),$(".button").attr("data-theme","darkmode"),$("#button").attr("data-theme","darkmode"),$(".send").attr("data-theme","darkmode"),$("#sendbox").attr("data-theme","darkmode"),$("#messagecontainer").attr("data-theme","darkmode"),$("#textbox").attr("data-theme","darkmode"))}